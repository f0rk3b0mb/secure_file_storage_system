<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
</head>
<body bgcolor="cyan">
<br>
<a href="/dashboard">user dashboard</a><br>
<a href="/upload">upload files</a><br>
<a href="/logout">logout</a><br>
<a href="/register">register</a><br>
<a href="/users">users</a><br>
<a href="/files">files</a>
<br>
<h1><center>Welcome, {{ username }}</h1></center></h1>
<br>

<!-- Display pending users here -->
<h2>Pending Deletion Requests</h2>
    <table border="1">
      <thead>
        <tr>
          <th>File Name</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for file in pending_deletion_requests %}
          <tr>
            <td>{{ file.file_name }}</td>
            <td>
              <button onclick="approveDeletion('{{ file.file_name }}')">Approve</button>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <br>
    <br>
    <h2>Pending Users</h2>
<table border="1">
    <thead>
        <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Role</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for user in pending_users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.role }}</td>
                <td>
                    <button onclick="approveUser('{{ user.id }}')">Approve</button>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
<br>
<br>

<script>
  // Function to fetch and display pending users
  function displayPendingUsers() {
      fetch('/api/pending_users')
          .then(response => response.json())
          .then(data => {
              const table = document.querySelector('table tbody');
              table.innerHTML = ''; // Clear the existing table rows

              data.forEach(user => {
                  const row = table.insertRow(table.rows.length);
                  const usernameCell = row.insertCell(0);
                  const emailCell = row.insertCell(1);
                  const roleCell = row.insertCell(2);
                  const actionCell = row.insertCell(3);
                  usernameCell.innerHTML = user.username;
                  emailCell.innerHTML = user.email;
                  roleCell.innerHTML = user.role;
                  actionCell.innerHTML = `<button onclick="approveUser('${user.id}')">Approve</button>`;
              });
          });
  }

  // Initial display of pending users
  displayPendingUsers();

  // JavaScript function to approve a user
  function approveUser(userId) {
      // You can make an API call to approve the user by sending a request to the server
      fetch(`/api/approve_user/${userId}`, { method: 'POST' })
          .then(response => {
              if (response.status === 200) {
                  // Display updated list of pending users
                  displayPendingUsers();
                  // Optionally, you can update the UI to indicate that the user has been approved
                  alert('User approved successfully');
              } else {
                  alert('Failed to approve user');
              }
          });
  }
    // Function to fetch and display pending deletion requests
    function displayPendingDeletionRequests() {
        fetch('/api/pending_deletion_requests')
          .then(response => response.json())
          .then(data => {
            const table = document.querySelector('table tbody');
            table.innerHTML = ''; // Clear the existing table rows

            data.forEach(file => {
              const row = table.insertRow(table.rows.length);
              const fileNameCell = row.insertCell(0);
              const actionCell = row.insertCell(1);
              fileNameCell.innerHTML = file.file_name;
              actionCell.innerHTML = `<button onclick="approveDeletion('${file.file_name}')">Approve</button>`;
            });
          });
      }

      // Initial display of pending deletion requests
      displayPendingDeletionRequests();

      // JavaScript function to approve a file deletion request
      function approveDeletion(fileName) {
        // You can make an API call to approve the file deletion by sending a request to the server
        fetch(`/api/approve_deletion/${fileName}`, { method: 'POST' })
          .then(response => {
            if (response.status === 200) {
              // Display updated list of pending deletion requests
              displayPendingDeletionRequests();
              // Optionally, you can update the UI to indicate that the deletion request has been approved
              alert('Deletion request approved successfully');
            } else {
              alert('Failed to approve deletion request');
            }
          });
      }
</script>


</body>
</html>
