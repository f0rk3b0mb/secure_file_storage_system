<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link rel="stylesheet" type="text/css" href="/static/css/main.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="Dashboard">

        <div class="side_bar">
            <div class="logo"><img src="/static/images/logo.png"></div>
            <div class="link_bar">
              <div class="links">
                    <button class="menu_item"><a href="/dashboard">dashboard</a></button>
                    <button class="menu_item"><a href="/upload">upload files</a></button>
                    <button class="menu_item"><a href="/logout">logout</a></button>
                    <button class="menu_item"><a href="/register">register</a></button>
                    <button class="menu_item"><a href="/users">users</a></button>
                    <button class="menu_item"><a href="/files">files</a></button>
                    <button class="menu_item" onclick="confirm()"><a href="/backup">backup</a></button>
                    <button class="menu_item"><a href="/report">report</a></button>
                </div>
            </div>
            <div class="footer"><b><p>SecureFileStorage @2023</p></b></div>
        </div>

        <div class="right_side">
            <div class="top_bar">
                <h3><center>Welcome, {{ username }}</center></h3>
                
                </div>

                <p>{{message}}</p>

                <input placeholder="search" class="search" id="searchField">
                


                <div class="view">
                    <div class="tabs">
                      <button class="tab_item" id="showUsers">pending user approvals</button> <!-- will add functionality to buttons-->
                      <button class="tab_item" id="showFiles">pending file approvals</button>
                    </div>    
                    <div class="table">
                        <div  id="pendingUsers" class="mini_table">
                          <h3>pending users</h3>
                          <table border="1">
                            <thead>
                                <tr>
                                    
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="pendingUserApprovals">
                            </tbody>
                        </table>
                        </div>
                        <div  id="pendingFiles" class="mini_table">
                            <h3>pending file approvals</h3>
                            <table border="1">
                                <thead>
                                    
                                    
                                    <tr>
                                       
                                        <th>File Name</th>
                                        <th>Owner</th>
                                        <th>Permission Level</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="pendingFileDeletionApprovals">
                                </tbody>
                            </table>
                          </div>
                  </div>
                  </div>


                </div>

    </div>


<script>
document.getElementById('pendingUsers').style.display = 'block';
document.getElementById('pendingFiles').style.display = 'none';

    document.getElementById('showUsers').addEventListener('click', function() {
        showElement("pendingUsers");
            hideElement('pendingFiles');
        });

        document.getElementById('showFiles').addEventListener('click', function() {
            showElement('pendingFiles');
            hideElement('pendingUsers');
        });

        function hideElement(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }
        function showElement(elementId) {
            document.getElementById(elementId).style.display = 'block';
        }
  // Function to fetch and display pending user approvals
  function confirm(){
    alert("Create backup")
  }
  function displayPendingUserApprovals() {
      fetch('/api/pending_users')
          .then(response => response.json())
          .then(data => {
              const pendingUserApprovals = document.getElementById('pendingUserApprovals');
              pendingUserApprovals.innerHTML = ''; // Clear the existing content

              if (data.length === 0) {
                  const row = pendingUserApprovals.insertRow(0);
                  const cell = row.insertCell(0);
                  cell.colSpan = 5;
                  cell.textContent = 'No pending user approvals.';
              } else {
                  data.forEach(user => {
                      const row = pendingUserApprovals.insertRow(pendingUserApprovals.rows.length);
                      const usernameCell = row.insertCell(0);
                      usernameCell.textContent = user.username;
                      const emailCell = row.insertCell(1);
                      emailCell.textContent = user.email;
                      const roleCell = row.insertCell(2);
                      roleCell.textContent = user.role;
                      const actionCell = row.insertCell(3);
                      const approveButton = document.createElement('button');
                      approveButton.textContent = 'Approve';
                      approveButton.addEventListener('click', () => approveUser(user.id));
                      actionCell.appendChild(approveButton);
                  });
              }
          });
  }

  // Function to send an approval request for a user
  function approveUser(userId) {
      // Send a POST request to approve the user
      fetch(`/api/approve_user/${userId}`, { method: 'POST' })
          .then(response => {
              if (response.status === 200) {
                  // Display updated list of pending user approvals
                  displayPendingUserApprovals();
                  // Optionally, you can update the UI to indicate that the user has been approved
                  alert('User approved successfully');
              } else {
                  alert('Failed to approve user');
              }
          });
  }

  // Function to fetch and display pending file deletion approvals
  function displayPendingFileDeletionApprovals() {
      fetch('/api/pending_deletion_requests')
          .then(response => response.json())
          .then(data => {
              const pendingFileDeletionApprovals = document.getElementById('pendingFileDeletionApprovals');
              pendingFileDeletionApprovals.innerHTML = ''; // Clear the existing content

              if (data.length === 0) {
                  const row = pendingFileDeletionApprovals.insertRow(0);
                  const cell = row.insertCell(0);
                  cell.colSpan = 5;
                  cell.textContent = 'No pending file deletion approvals.';
              } else {
                  data.forEach(file => {
                      const row = pendingFileDeletionApprovals.insertRow(pendingFileDeletionApprovals.rows.length);
                      const fileNameCell = row.insertCell(0);
                      fileNameCell.textContent = file.filename;
                      const ownerCell = row.insertCell(1);
                      ownerCell.textContent = file.owner;
                      const permissionCell = row.insertCell(2);
                      permissionCell.textContent = file.permission;
                      const actionCell = row.insertCell(3);
                      const approveButton = document.createElement('button');
                      approveButton.textContent = 'Approve';
                      approveButton.addEventListener('click', () => approveDeletion(file.file_id));
                      actionCell.appendChild(approveButton);
                  });
              }
          });
  }

  // Function to send an approval request for file deletion
  function approveDeletion(fileId) {
      // Send a POST request to approve file deletion
      fetch(`/api/approve_deletion/${fileId}`, { method: 'POST' })
          .then(response => {
              if (response.status === 200) {
                  // Display updated list of pending file deletion approvals
                  displayPendingFileDeletionApprovals();
                  // Optionally, you can update the UI to indicate that the deletion request has been approved
                  alert('Deletion request approved successfully');
              } else {
                  alert('Failed to approve deletion request');
              }
          });
  }

  // Initial display of pending approvals
  displayPendingUserApprovals();
  displayPendingFileDeletionApprovals();


  
</script>

</body>
</html>
