<!DOCTYPE html>
<html>
  <head>
    <title>Dashboard</title>
    <link rel="stylesheet" type="text/css" href="/static/css/dashboard.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body bgcolor="cyan">
    <div class="top_bar">
      <h3>Welcome, {{username}}</h3>
      <link_bar>
        <button1><a href="/upload">upload files</a></button1>
        <button1><a href="/faq">help</a></button1>
        <button1><a href="/logout">logout</a></button1>
        </link_bar>
    </div>
    <h3>Your uploaded files:</h3>
    <div class="tables"><div class="mini">
      <h3>Private Files:</h3>
      <ul id="privateFileList"></ul></div>
      <div class="mini"><h3>Public Files:</h3>
        <ul id="publicFileList"></ul></div>
      
    </div>


    <div class="footer">
      <h4>Secure file storage system @2023</h4>
    </div>

    <script>
      // Function to create a list item with a link and a request button for private files
      function addPrivateFileListItem(fileName) {
        const fileList = document.getElementById("privateFileList");
        const listItem = document.createElement("li");

        // Create a link for downloading
        const fileLink = document.createElement("a");
        fileLink.href = `/api/download/${fileName}`;
        fileLink.textContent = fileName;

        // Create a request button for private files
        const requestButton = document.createElement("button");
        requestButton.textContent = "Request Deletion";
        requestButton.addEventListener("click", () => requestDelete(fileName));

        // Append the link and request button to the list item
        listItem.appendChild(fileLink);
        listItem.appendChild(requestButton);

        // Append the list item to the private list
        fileList.appendChild(listItem);
      }

      // Function to create a list item with a link for public files
      function addPublicFileListItem(fileName) {
        const fileList = document.getElementById("publicFileList");
        const listItem = document.createElement("li");

        // Create a link for downloading
        const fileLink = document.createElement("a");
        fileLink.href = `/api/download/public/${fileName}`;
        fileLink.textContent = fileName;

        // Append the link to the list item
        listItem.appendChild(fileLink);

        // Append the list item to the public list
        fileList.appendChild(listItem);
      }

      // Fetch the list of files and create list items with links and request buttons for private files
      function fetchFileList() {
        fetch("/api/viewFiles")
          .then((response) => response.json())
          .then((data) => {
            const privateFileList = document.getElementById("privateFileList");
            const publicFileList = document.getElementById("publicFileList");
            privateFileList.innerHTML = ""; // Clear the private list
            publicFileList.innerHTML = ""; // Clear the public list

            data.private.forEach((fileName) => {
              addPrivateFileListItem(fileName);
            });

            data.public.forEach((fileName) => {
              addPublicFileListItem(fileName);
            });
          });
      }

      // Send a request for file deletion
      function requestDelete(fileName) {
        fetch("/api/deleteFiles", {
          method: "POST",
          body: new URLSearchParams({ file_name: fileName }),
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
        })
          .then((response) => {
            if (response.ok) {
              alert(
                "Your deletion request has been sent to the admin for approval."
              );
            } else {
              console.error("Failed to send deletion request");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }

      // Initial fetch of the file list when the page loads
      fetchFileList();
    </script>
  </body>
</html>
